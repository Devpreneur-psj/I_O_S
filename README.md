# ì •ë ¹ì˜ ì„¬ (SOI) í”„ë¡œì íŠ¸ ë³´ê³ ì„œ

---

## ğŸ“‹ í‘œì§€

**ì œì¶œì¼**: 2025ë…„ 11ì›” 30ì¼

| í•­ëª© | ë‚´ìš© |
|------|------|
| í•™ë…„/í•™ë²ˆ | [ì‘ì„± í•„ìš”] |
| ë ˆë²¨ | [ì‘ì„± í•„ìš”] |
| ë¬¸ì œëª… | ì •ë ¹ì˜ ì„¬ (SOI) - ì •ë ¹ ì„±ì¥ RPG ì›¹ ê²Œì„ ê°œë°œ |
| ì´ë¦„ | [ì‘ì„± í•„ìš”] |
| ë¬¸ì œë²ˆí˜¸ | [ì‘ì„± í•„ìš”] |

---

## ğŸ“‘ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì‹œìŠ¤í…œ ë¶„ì„ ë° ì„¤ê³„](#2-ì‹œìŠ¤í…œ-ë¶„ì„-ë°-ì„¤ê³„)
3. [ê¸°ìˆ  ìŠ¤íƒ ë° ê°œë°œ í™˜ê²½](#3-ê¸°ìˆ -ìŠ¤íƒ-ë°-ê°œë°œ-í™˜ê²½)
4. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#4-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
5. [ì£¼ìš” ê¸°ëŠ¥ êµ¬í˜„](#5-ì£¼ìš”-ê¸°ëŠ¥-êµ¬í˜„)
6. [ì†ŒìŠ¤ì½”ë“œ ìƒì„¸ ë¶„ì„](#6-ì†ŒìŠ¤ì½”ë“œ-ìƒì„¸-ë¶„ì„)
7. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„](#7-í”„ë¡ íŠ¸ì—”ë“œ-êµ¬í˜„)
8. [ë³´ì•ˆ ë° ì¸ì¦ ì‹œìŠ¤í…œ](#8-ë³´ì•ˆ-ë°-ì¸ì¦-ì‹œìŠ¤í…œ)
9. [ë°°í¬ ë° ìš´ì˜](#9-ë°°í¬-ë°-ìš´ì˜)
10. [í…ŒìŠ¤íŠ¸ ë° ê²€ì¦](#10-í…ŒìŠ¤íŠ¸-ë°-ê²€ì¦)
11. [ê²°ë¡  ë° í–¥í›„ ê³„íš](#11-ê²°ë¡ -ë°-í–¥í›„-ê³„íš)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### 1.1 í”„ë¡œì íŠ¸ ì†Œê°œ

**ì •ë ¹ì˜ ì„¬ (SOI)**ì€ ì„¸ê³„ìˆ˜ ê¸°ë°˜ì˜ ì •ë ¹ ì„±ì¥ RPG ì‹œë®¬ë ˆì´ì…˜ ì›¹ ê²Œì„ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì„¸ê³„ìˆ˜ë¥¼ í‚¤ìš°ê³ , ì •ë ¹ì„ ìƒì„±í•˜ì—¬ ì„±ì¥ì‹œí‚¤ë©°, ë‹¤ì–‘í•œ ê²Œì„ ì½˜í…ì¸ ë¥¼ ì¦ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1.2 í”„ë¡œì íŠ¸ ëª©í‘œ

- Spring Boot ê¸°ë°˜ì˜ ì•ˆì •ì ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ
- ì •ë ¹ ì„±ì¥ ì‹œìŠ¤í…œì„ í†µí•œ ì¥ê¸°ì ì¸ ê²Œì„ í”Œë ˆì´ ìœ ë„
- ì‹¤ì‹œê°„ ìƒí˜¸ì‘ìš© ê¸°ëŠ¥ êµ¬í˜„ (WebSocket)
- í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜ ì„¤ê³„

### 1.3 ì£¼ìš” íŠ¹ì§•

- **ì •ë ¹ ì‹œìŠ¤í…œ**: 5ê°€ì§€ ì†ì„±(ë¶ˆ, ë¬¼, í’€, ë¹›, ì–´ë‘ )ì˜ ì •ë ¹ ìƒì„± ë° ì„±ì¥
- **ì„¸ê³„ìˆ˜ ì‹œìŠ¤í…œ**: ë ˆë²¨ì—…ì„ í†µí•œ ê²Œì„ ì§„í–‰
- **ë˜ì „ ì‹œìŠ¤í…œ**: 6ë‹¨ê³„ ë˜ì „ì„ í†µí•œ ì „íˆ¬ ë° ë³´ìƒ
- **ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥**: ì¹œêµ¬ ì‹œìŠ¤í…œ ë° ì •ë ¹ ê´‘ì¥
- **ììœ¨ í–‰ë™ ì‹œìŠ¤í…œ**: ì •ë ¹ì˜ AI ê¸°ë°˜ ììœ¨ í–‰ë™

---

## 2. ì‹œìŠ¤í…œ ë¶„ì„ ë° ì„¤ê³„

### 2.1 ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¼ìš°ì €)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Thymeleaf  â”‚  â”‚  JavaScript  â”‚  â”‚     CSS      â”‚  â”‚
â”‚  â”‚   Templates  â”‚  â”‚   (ES6+)     â”‚  â”‚   (CSS3)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP/WebSocket
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx Reverse Proxy (í¬íŠ¸ 80/443)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Spring Boot Application (í¬íŠ¸ 8080)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Controller  â”‚  â”‚   Service    â”‚  â”‚  Repository  â”‚  â”‚
â”‚  â”‚    Layer     â”‚  â”‚    Layer     â”‚  â”‚    Layer     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Spring       â”‚  â”‚   JPA/       â”‚  â”‚  WebSocket   â”‚  â”‚
â”‚  â”‚ Security     â”‚  â”‚ Hibernate    â”‚  â”‚   Support    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              H2 Database (íŒŒì¼ ê¸°ë°˜)                       â”‚
â”‚              ./data/soi-db.mv.db                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 íŒ¨í‚¤ì§€ êµ¬ì¡°

```
com.soi/
â”œâ”€â”€ SoiApplication.java              # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤
â”œâ”€â”€ config/                          # ì„¤ì • í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ SecurityConfig.java          # Spring Security ì„¤ì •
â”‚   â””â”€â”€ MasterAccountInitializer.java # ë§ˆìŠ¤í„° ê³„ì • ì´ˆê¸°í™”
â”œâ”€â”€ controller/                      # HTTP ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ HomeController.java
â”‚   â”œâ”€â”€ LoginController.java
â”‚   â”œâ”€â”€ RegisterController.java
â”‚   â””â”€â”€ WorldController.java
â”œâ”€â”€ user/                           # ì‚¬ìš©ì ë„ë©”ì¸
â”‚   â”œâ”€â”€ User.java
â”‚   â”œâ”€â”€ UserRepository.java
â”‚   â”œâ”€â”€ UserService.java
â”‚   â””â”€â”€ CustomUserDetailsService.java
â”œâ”€â”€ spirit/                         # ì •ë ¹ ë„ë©”ì¸
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ enums/
â”‚   â””â”€â”€ constants/
â”œâ”€â”€ worldtree/                      # ì„¸ê³„ìˆ˜ ë„ë©”ì¸
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ controller/
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ explorer/                       # ë˜ì „/ì „íˆ¬ ë„ë©”ì¸
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ controller/
â”œâ”€â”€ community/                      # ì»¤ë®¤ë‹ˆí‹° ë„ë©”ì¸
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ controller/
â”œâ”€â”€ game/                          # ê²Œì„ ì‹œê°„ ê´€ë¦¬
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ repository/
â”‚   â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ controller/
â”‚   â””â”€â”€ scheduler/
â”œâ”€â”€ tutorial/                      # íŠœí† ë¦¬ì–¼ ì‹œìŠ¤í…œ
â”‚   â”œâ”€â”€ service/
â”‚   â””â”€â”€ controller/
â””â”€â”€ system/                        # ì‹œìŠ¤í…œ ê¸°ëŠ¥
    â””â”€â”€ controller/
```

---

## 3. ê¸°ìˆ  ìŠ¤íƒ ë° ê°œë°œ í™˜ê²½

### 3.1 ë°±ì—”ë“œ ê¸°ìˆ  ìŠ¤íƒ

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| Java | 17 | í”„ë¡œê·¸ë˜ë° ì–¸ì–´ |
| Spring Boot | 3.2.0 | ì›¹ í”„ë ˆì„ì›Œí¬ |
| Spring Security | 6.x | ì¸ì¦ ë° ë³´ì•ˆ |
| Spring Data JPA | 3.x | ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ |
| Hibernate | 6.x | ORM í”„ë ˆì„ì›Œí¬ |
| H2 Database | 2.x | ë°ì´í„°ë² ì´ìŠ¤ |
| Maven | 3.x | ë¹Œë“œ ë„êµ¬ |
| WebSocket | - | ì‹¤ì‹œê°„ í†µì‹  |

### 3.2 í”„ë¡ íŠ¸ì—”ë“œ ê¸°ìˆ  ìŠ¤íƒ

| ê¸°ìˆ  | ë²„ì „ | ìš©ë„ |
|------|------|------|
| Thymeleaf | 3.x | ì„œë²„ ì‚¬ì´ë“œ í…œí”Œë¦¿ ì—”ì§„ |
| JavaScript | ES6+ | í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ë¡œì§ |
| CSS | CSS3 | ìŠ¤íƒ€ì¼ë§ |
| HTML5 | - | ë§ˆí¬ì—… |

### 3.3 ì¸í”„ë¼ ë° ë°°í¬

| ê¸°ìˆ  | ìš©ë„ |
|------|------|
| Docker | ì»¨í…Œì´ë„ˆí™” |
| Docker Compose | ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |
| Nginx | ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ |
| Let's Encrypt | SSL ì¸ì¦ì„œ |

### 3.4 ê°œë°œ í™˜ê²½ ì„¤ì •

#### 3.4.1 pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.0</version>
        <relativePath/>
    </parent>

    <groupId>com.soi</groupId>
    <artifactId>soi</artifactId>
    <version>1.0.0</version>
    <name>SOI</name>
    <description>Spring Boot Login Application</description>

    <properties>
        <java.version>17</java.version>
    </properties>

    <dependencies>
        <!-- Spring Boot Web -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        
        <!-- Thymeleaf -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        
        <!-- Spring Security -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
        
        <dependency>
            <groupId>org.thymeleaf.extras</groupId>
            <artifactId>thymeleaf-extras-springsecurity6</artifactId>
        </dependency>
        
        <!-- JPA -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        
        <!-- H2 Database -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>
        
        <!-- Validation -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        
        <!-- WebSocket -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-websocket</artifactId>
        </dependency>
        
        <!-- Test -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

---

## 4. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 4.1 ERD (Entity Relationship Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚         â”‚   Spirit    â”‚         â”‚ SpiritType  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â—„â”€â”€â”     â”‚ id (PK)     â”‚         â”‚ id (PK)     â”‚
â”‚ username    â”‚   â”‚     â”‚ userId (FK) â”‚         â”‚ name        â”‚
â”‚ password    â”‚   â”‚     â”‚ spiritType  â”‚         â”‚ element     â”‚
â”‚ email       â”‚   â”‚     â”‚ level       â”‚         â”‚ baseStats   â”‚
â”‚ createdAt   â”‚   â”‚     â”‚ experience  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚ intimacy    â”‚
                  â”‚     â”‚ personality â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚ stats...    â”‚         â”‚ WorldTree   â”‚
â”‚ WorldTree   â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ Status      â”‚
â”‚ Status      â”‚   â”‚              â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚              â”‚              â”‚ id (PK)     â”‚
â”‚ id (PK)     â”‚   â”‚              â”‚              â”‚ userId (FK) â”‚
â”‚ userId (FK) â”‚â”€â”€â”€â”˜              â”‚              â”‚ level       â”‚
â”‚ level       â”‚                  â”‚              â”‚ experience  â”‚
â”‚ experience  â”‚                  â”‚              â”‚ essence     â”‚
â”‚ essence     â”‚                  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                                 â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Skill     â”‚              â”‚    Item     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚ id (PK)     â”‚              â”‚ id (PK)     â”‚
         â”‚ name        â”‚              â”‚ name        â”‚
         â”‚ type        â”‚              â”‚ type        â”‚
         â”‚ effect      â”‚              â”‚ effect      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ì£¼ìš” ì—”í‹°í‹° ì„¤ëª…

#### 4.2.1 User ì—”í‹°í‹°

ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì—”í‹°í‹°ì…ë‹ˆë‹¤.

```java
package com.soi.user;

import jakarta.persistence.*;
import java.time.LocalDateTime;

@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true, nullable = false, length = 50)
    private String username;

    @Column(nullable = false)
    private String password;

    @Column(unique = true, nullable = false)
    private String email;

    @Column(name = "created_at", nullable = false)
    private LocalDateTime createdAt = LocalDateTime.now();

    // Getters and Setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
    
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    
    public LocalDateTime getCreatedAt() { return createdAt; }
    public void setCreatedAt(LocalDateTime createdAt) { this.createdAt = createdAt; }
}
```

#### 4.2.2 Spirit ì—”í‹°í‹°

ì •ë ¹ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” í•µì‹¬ ì—”í‹°í‹°ì…ë‹ˆë‹¤.

```java
package com.soi.spirit.entity;

import jakarta.persistence.*;
import java.time.LocalDateTime;

/**
 * ì •ë ¹ ì—”í‹°í‹°
 */
@Entity
@Table(name = "spirits")
public class Spirit {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "user_id", nullable = false)
    private Long userId;

    @Column(name = "spirit_type", nullable = false, length = 50)
    private String spiritType; // ë¶ˆì˜ ì •ë ¹, ë¬¼ì˜ ì •ë ¹, í’€ì˜ ì •ë ¹, ë¹›ì˜ ì •ë ¹, ì–´ë‘ ì˜ ì •ë ¹

    @Column(name = "evolution_stage", nullable = false)
    private Integer evolutionStage = 0; // 0: ê¸°ë³¸, 1: 1ì°¨ ì§„í™”, 2: 2ì°¨ ì§„í™”

    @Column(name = "name", length = 50)
    private String name; // ì •ë ¹ ì´ë¦„ (ì‚¬ìš©ìê°€ ì§€ì„ ìˆ˜ ìˆìŒ)

    @Column(name = "level", nullable = false)
    private Integer level = 1; // ì •ë ¹ ë ˆë²¨ (ìµœëŒ€ 30)

    @Column(name = "experience", nullable = false)
    private Integer experience = 0; // ê²½í—˜ì¹˜

    @Column(name = "intimacy", nullable = false)
    private Integer intimacy = 1; // ì¹œë°€ë„ (1-10)

    @Column(name = "personality", nullable = false, length = 20)
    private String personality; // ê³ ì§‘, ì¡°ì‹¬, ì¥ë‚œê¾¸ëŸ¬ê¸°, ì˜¨ìˆœ, ìš©ê°

    // ëŠ¥ë ¥ì¹˜
    @Column(name = "ranged_attack", nullable = false)
    private Integer rangedAttack = 0; // ì›ê±°ë¦¬ ê³µê²©ë ¥

    @Column(name = "melee_attack", nullable = false)
    private Integer meleeAttack = 0; // ê·¼ê±°ë¦¬ ê³µê²©ë ¥

    @Column(name = "ranged_defense", nullable = false)
    private Integer rangedDefense = 0; // ì›ê±°ë¦¬ ë°©ì–´ë ¥

    @Column(name = "melee_defense", nullable = false)
    private Integer meleeDefense = 0; // ê·¼ê±°ë¦¬ ë°©ì–´ë ¥

    @Column(name = "speed", nullable = false)
    private Integer speed = 0; // ìŠ¤í”¼ë“œ

    // ìˆ˜ëª… ê´€ë ¨
    @Column(name = "max_level_reached", nullable = false)
    private Boolean maxLevelReached = false; // ìµœëŒ€ ë ˆë²¨ ë‹¬ì„± ì—¬ë¶€

    @Column(name = "lifespan_countdown")
    private LocalDateTime lifespanCountdown; // ìˆ˜ëª… ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘ì¼

    @Column(name = "lifespan_extended")
    private Integer lifespanExtended = 0; // ìƒëª…ì—°ì¥ ì•„ì´í…œìœ¼ë¡œ ì—°ì¥ëœ ì¼ìˆ˜

    // ìƒíƒœ ê´€ë¦¬
    @Column(name = "health_status", length = 50)
    private String healthStatus = "ê±´ê°•"; // ê±´ê°• ìƒíƒœ

    @Column(name = "happiness", nullable = false)
    private Integer happiness = 50; // í–‰ë³µë„ (0-100)

    @Column(name = "mood", length = 50)
    private String mood = "ë³´í†µ"; // ê¸°ë¶„

    @Column(name = "hunger", nullable = false)
    private Integer hunger = 50; // ë°°ê³ í”” (0-100)

    @Column(name = "energy", nullable = false)
    private Integer energy = 100; // ì—ë„ˆì§€ (0-100)

    @Column(name = "created_at", nullable = false)
    private LocalDateTime createdAt = LocalDateTime.now();

    @Column(name = "last_action_time")
    private LocalDateTime lastActionTime; // ë§ˆì§€ë§‰ í–‰ë™ ì‹œê°„

    // Getters and Setters
    // ... (ìƒëµ)
}
```

---

## 5. ì£¼ìš” ê¸°ëŠ¥ êµ¬í˜„

### 5.1 ê¸°ëŠ¥ ëª©ë¡ (í•„ìš”í•œ ê¸°ëŠ¥, ì™„ì„± ì—¬ë¶€, ì„¤ëª…)

#### 5.1.1 í•µì‹¬ ê²Œì„ ì‹œìŠ¤í…œ

| í•„ìš”í•œ ê¸°ëŠ¥ | ì™„ì„± ì—¬ë¶€ | ì„¤ëª… |
|------------|----------|------|
| ì‚¬ìš©ì ì¸ì¦ ë° íšŒì›ê°€ì… | âœ… ì™„ë£Œ | Spring Security ê¸°ë°˜ ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œìŠ¤í…œ. BCryptë¥¼ ì‚¬ìš©í•œ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”, ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦ êµ¬í˜„ |
| ì„¸ê³„ìˆ˜ ë ˆë²¨ì—… ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ì˜ ì¶•ë³µì„ ê²½í—˜ì¹˜ë¡œ ë³€í™˜í•˜ì—¬ ë ˆë²¨ì—…. Medium Slow ê²½í—˜ì¹˜ ê³¡ì„  ì ìš© (nÂ³ Ã— 0.8 + n Ã— 50), ë ˆë²¨ë‹¹ 8% ë°°ìœ¨ ì¦ê°€ |
| ì •ë ¹ ìƒì„± ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ë ˆë²¨ 2 ë‹¬ì„± ì‹œ ì •ë ¹ ìƒì„± ê°€ëŠ¥, 5ê°€ì§€ ì†ì„± ì„ íƒ (ë¶ˆ, ë¬¼, í’€, ë¹›, ì–´ë‘ ). ì„±ê²© ëœë¤ ë¶€ì—¬, ì´ˆê¸° ëŠ¥ë ¥ì¹˜ ì„¤ì • |
| ì •ë ¹ ì„±ì¥ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ê²½í—˜ì¹˜ íšë“ ë° ë ˆë²¨ì—…, ëŠ¥ë ¥ì¹˜ ì„±ì¥. ìµœëŒ€ ë ˆë²¨ 30, ê²½í—˜ì¹˜ ê³µì‹: nÂ³ Ã— 0.8 + n Ã— 50 |
| ì •ë ¹ ì§„í™” ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | 3ë‹¨ê³„ ì§„í™” ì‹œìŠ¤í…œ (ê¸°ë³¸ â†’ 1ì°¨ â†’ 2ì°¨). ì§„í™” ì¡°ê±´ ì¶©ì¡± ì‹œ ìë™ ì§„í™”, ì§„í™” ì¤‘ ìƒíƒœ ê´€ë¦¬ |
| ë˜ì „ ë° ì „íˆ¬ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | 6ë‹¨ê³„ ë˜ì „, í¬ì¼“ëª¬ ìŠ¤íƒ€ì¼ ì „íˆ¬ ì‹œìŠ¤í…œ. ì†ì„± ìƒì„± ì‹œìŠ¤í…œ, ê¸°ìˆ  ì‚¬ìš©, í„´ì œ ì „íˆ¬ |
| ì•„ì´í…œ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ìƒì ì—ì„œ ì•„ì´í…œ êµ¬ë§¤ ë° ì •ë ¹ì—ê²Œ ì‚¬ìš©. ë‹¤ì–‘í•œ ì•„ì´í…œ íš¨ê³¼ (ê±´ê°• íšŒë³µ, í–‰ë³µë„ ì¦ê°€, ëŠ¥ë ¥ì¹˜ í–¥ìƒ ë“±) |
| í›ˆë ¨ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ ëŠ¥ë ¥ì¹˜ í–¥ìƒì„ ìœ„í•œ í›ˆë ¨ ì‹œìŠ¤í…œ. í›ˆë ¨ íƒ€ì…ë³„ íš¨ê³¼ ì°¨ë³„í™” |
| ììœ¨ í–‰ë™ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ì˜ AI ê¸°ë°˜ ììœ¨ í–‰ë™ (ì„±ê²©ë³„ íŠ¹ë³„ í–‰ë™). ë§¤ 5ë¶„ë§ˆë‹¤ ìë™ ìƒíƒœ ì—…ë°ì´íŠ¸, ì„±ê²©ì— ë”°ë¥¸ ëŠ¥ë ¥ì¹˜ ë³€í™” |
| ëœë¤ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ë‚ ì”¨ ë³€í™”, ì§ˆë³‘, íŠ¹ë³„ ì´ë²¤íŠ¸ ë“±. ë§¤ 6ì‹œê°„ë§ˆë‹¤ ëœë¤ ì´ë²¤íŠ¸ ìƒì„± |
| ìƒì•  ì£¼ê¸° ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ë‚˜ì´ ì¦ê°€, ì€í‡´, ìˆ˜ëª… ê´€ë¦¬. ìµœëŒ€ ë ˆë²¨ ë‹¬ì„± í›„ 10ì¼ ìˆ˜ëª…, ìƒëª…ì—°ì¥ ì•„ì´í…œìœ¼ë¡œ ì—°ì¥ ê°€ëŠ¥ |
| ëŒ€íšŒ/ê²½ìŸ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ ëŠ¥ë ¥ì¹˜ ê¸°ë°˜ ê²½ìŸ ë° ìƒê¸ˆ ì§€ê¸‰. ìŠ¹ë¥  ê³„ì‚° ë° ë³´ìƒ ì‹œìŠ¤í…œ |
| ì¹œêµ¬ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì¹œêµ¬ ì¶”ê°€, ì¹œêµ¬ ë§ˆì„ ë°©ë¬¸. ì¹œêµ¬ ëª©ë¡ ê´€ë¦¬, ì¹œêµ¬ì—ê²Œ ì„ ë¬¼ ë³´ë‚´ê¸° |
| ì •ë ¹ ê´‘ì¥ (WebSocket) | âœ… ì™„ë£Œ | ì‹¤ì‹œê°„ ì±„íŒ… ë° ì •ë ¹ ì†Œê°œ. WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ í†µì‹ , ë‹¤ì¤‘ ì±„ë„ ì§€ì› |
| íŠœí† ë¦¬ì–¼ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | 4ë‹¨ê³„ ê°€ì´ë“œ ì‹œìŠ¤í…œ. ì²« ë¡œê·¸ì¸ ì‹œ ìë™ í‘œì‹œ, í•˜ì´ë¼ì´íŠ¸ ë° í™”ì‚´í‘œ ê°€ì´ë“œ |
| ê²Œì„ ì‹œê°„ ê´€ë¦¬ | âœ… ì™„ë£Œ | ê²Œì„ ë‚´ ì‹œê°„ íë¦„ ê´€ë¦¬. ë§¤ ì‹œê°„ë§ˆë‹¤ ê²Œì„ ì‹œê°„ ì§„í–‰, ììœ¨ í–‰ë™ ì²˜ë¦¬ |
| ë¡œê·¸ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ê²Œì„ ì´ë²¤íŠ¸ ë¡œê·¸ ê¸°ë¡ ë° ì¡°íšŒ. ì „íˆ¬ ë¡œê·¸, ê²Œì„ ì´ë²¤íŠ¸ ë¡œê·¸, ì—ëŸ¬ ë¡œê·¸ ë¶„ë¦¬ ê´€ë¦¬ |

#### 5.1.2 ì¶”ê°€ ê¸°ëŠ¥

| í•„ìš”í•œ ê¸°ëŠ¥ | ì™„ì„± ì—¬ë¶€ | ì„¤ëª… |
|------------|----------|------|
| ê¸°ìˆ  í•™ìŠµ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ì´ ê¸°ìˆ ì„ í•™ìŠµí•˜ëŠ” ì‹œìŠ¤í…œ. ë§ˆë²• ì•„ì¹´ë°ë¯¸ì—ì„œ ê¸°ìˆ  í•™ìŠµ, í•™ìŠµ ì‹œê°„ ê´€ë¦¬ |
| ì •ë ¹ ìƒí˜¸ì‘ìš© ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ ê°„ ìƒí˜¸ì‘ìš© ì²˜ë¦¬. ì •ë ¹ ê°„ ê°ˆë“±, í˜‘ë ¥ ë“± ë‹¤ì–‘í•œ ìƒí˜¸ì‘ìš© |
| ìƒì  ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì•„ì´í…œ êµ¬ë§¤ë¥¼ ìœ„í•œ ìƒì  ì‹œìŠ¤í…œ. ê³¨ë“œ ê¸°ë°˜ êµ¬ë§¤, ë‹¤ì–‘í•œ ì•„ì´í…œ íŒë§¤ |
| ì •ë ¹ ë„ê° ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ì •ë ¹ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” ë„ê° ì‹œìŠ¤í…œ. ì •ë ¹ íƒ€ì…ë³„ ì •ë³´, ëŠ¥ë ¥ì¹˜, ì§„í™” ì •ë³´ ì œê³µ |
| íë§ ì„¼í„° | âœ… ì™„ë£Œ | ì •ë ¹ì˜ ê±´ê°• ìƒíƒœë¥¼ íšŒë³µí•˜ëŠ” ì‹œìŠ¤í…œ. ì§ˆë³‘ ì¹˜ë£Œ, ê±´ê°• íšŒë³µ |
| ê³ ëŒ€ ê¸°ë¡ ë³´ê´€ì†Œ | âœ… ì™„ë£Œ | ê²Œì„ ì´ë²¤íŠ¸ ë° ë¡œê·¸ë¥¼ ì¡°íšŒí•˜ëŠ” ì‹œìŠ¤í…œ. ê³¼ê±° ì´ë²¤íŠ¸ ê¸°ë¡ ì¡°íšŒ |
| ì„¤ì • ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ê²Œì„ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œ. ì‚¬ìš©ì ì„¤ì • ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸° |
| í¬ê·€ ì •ë ¹ ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | ë ˆë²¨ 15 ë‹¬ì„± ì‹œ í¬ê·€ ì •ë ¹ ì„ íƒ ê°€ëŠ¥. ë¹›ì˜ ì •ë ¹, ì–´ë‘ ì˜ ì •ë ¹ ì„ íƒ |
| ì •ë ¹ ê³ ì¹˜ ëŒë´ì£¼ê¸° | âœ… ì™„ë£Œ | í¬ê·€ ì •ë ¹ ê³ ì¹˜ë¥¼ ëŒë´ì£¼ëŠ” ì‹œìŠ¤í…œ. í•˜ë£¨ ìµœëŒ€ 5íšŒ, ëŒë´ì£¼ê¸° ê²Œì´ì§€ ê´€ë¦¬ |
| ì§„í™” ì—°êµ¬ì†Œ | âœ… ì™„ë£Œ | ì •ë ¹ ì§„í™”ë¥¼ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œ. ì§„í™” ì¡°ê±´ í™•ì¸, ì§„í™” ì§„í–‰ ìƒíƒœ ê´€ë¦¬ |
| í›ˆë ¨ì¥ | âœ… ì™„ë£Œ | ì •ë ¹ í›ˆë ¨ì„ ìˆ˜í–‰í•˜ëŠ” ì‹œìŠ¤í…œ. ë‹¤ì–‘í•œ í›ˆë ¨ íƒ€ì…, í›ˆë ¨ íš¨ê³¼ ì ìš© |
| ì •ë ¹ ì•„ë ˆë‚˜ | âœ… ì™„ë£Œ | ì •ë ¹ ëŒ€ì „ ì‹œìŠ¤í…œ. PvE ëŒ€ì „, ë³´ìƒ ì‹œìŠ¤í…œ |
| ë§ˆë²• ì•„ì¹´ë°ë¯¸ | âœ… ì™„ë£Œ | ê¸°ìˆ  í•™ìŠµ ì‹œìŠ¤í…œ. ê¸°ìˆ  ëª©ë¡ ì¡°íšŒ, í•™ìŠµ ì‹œì‘, í•™ìŠµ ì™„ë£Œ ì²˜ë¦¬ |

### 5.2 ê¸°ëŠ¥ ìƒì„¸ ì„¤ëª…

#### 5.2.1 ì‚¬ìš©ì ì¸ì¦ ë° íšŒì›ê°€ì…

**êµ¬í˜„ íŒŒì¼**: `LoginController.java`, `RegisterController.java`, `SecurityConfig.java`

**ì£¼ìš” ê¸°ëŠ¥**:
- ì‚¬ìš©ì íšŒì›ê°€ì… (ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸, ì´ë©”ì¼)
- Spring Security ê¸°ë°˜ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
- ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦
- ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (BCrypt)

**ì†ŒìŠ¤ì½”ë“œ**:

```java
package com.soi.controller;

import com.soi.user.UserService;
import com.soi.user.dto.UserRegisterDto;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;

@Controller
public class RegisterController {

    @Autowired
    private UserService userService;

    @GetMapping("/register")
    public String showRegisterForm(Model model) {
        model.addAttribute("userRegisterDto", new UserRegisterDto());
        return "register";
    }

    @PostMapping("/register")
    public String register(@Valid UserRegisterDto userRegisterDto, 
                          BindingResult bindingResult, 
                          Model model) {
        if (bindingResult.hasErrors()) {
            return "register";
        }

        try {
            userService.register(userRegisterDto);
            return "redirect:/login?registered=true";
        } catch (Exception e) {
            model.addAttribute("error", "íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + e.getMessage());
            return "register";
        }
    }
}
```

#### 5.2.2 ì„¸ê³„ìˆ˜ ë ˆë²¨ì—… ì‹œìŠ¤í…œ

**êµ¬í˜„ íŒŒì¼**: `WorldTreeService.java`, `WorldTreeController.java`

**ì£¼ìš” ê¸°ëŠ¥**:
- ì •ë ¹ì˜ ì¶•ë³µì„ ê²½í—˜ì¹˜ë¡œ ë³€í™˜
- ë ˆë²¨ì—… ì‹œ ë°°ìœ¨ ì ìš© (ë ˆë²¨ë‹¹ 8% ì¦ê°€)
- ë ˆë²¨ì—… ì‹œ í•´ê¸ˆ ê¸°ëŠ¥ ì•Œë¦¼

**ì†ŒìŠ¤ì½”ë“œ**:

```java
package com.soi.worldtree.service;

import com.soi.worldtree.dto.BlessingGrantRequest;
import com.soi.worldtree.dto.LevelUpResult;
import com.soi.worldtree.entity.WorldTreeStatus;
import com.soi.worldtree.repository.WorldTreeStatusRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@Transactional
public class WorldTreeService {

    private final WorldTreeStatusRepository statusRepository;

    @Autowired
    public WorldTreeService(WorldTreeStatusRepository statusRepository) {
        this.statusRepository = statusRepository;
    }

    /**
     * ë³´ìœ  ì¤‘ì¸ ì •ë ¹ì˜ ì¶•ë³µì„ ê²½í—˜ì¹˜ë¡œ ë¶€ì—¬í•©ë‹ˆë‹¤.
     */
    public LevelUpResult grantBlessingToExp(Long userId, BlessingGrantRequest request) {
        WorldTreeStatus status = statusRepository.findByUserId(userId)
                .orElseGet(() -> initializeNewUser(userId));

        long blessingToGrant = request.getAmount() == null 
            ? status.getAvailableEssence() 
            : Math.min(request.getAmount(), status.getAvailableEssence());

        if (blessingToGrant <= 0) {
            return getCurrentLevelUpResult(status, false);
        }

        // ë ˆë²¨ì— ë”°ë¥¸ ë°°ìœ¨ ê³„ì‚° (ë ˆë²¨ë‹¹ 8% ì¦ê°€)
        double multiplier = 1.0 + (status.getCurrentLevel() - 1) * 0.08;
        
        // ì¶•ë³µì„ EXPë¡œ ë³€í™˜
        long expGained = (long) (blessingToGrant * multiplier);
        
        // ê²½í—˜ì¹˜ ì¶”ê°€
        status.setExperience(status.getExperience() + expGained);
        status.setAvailableEssence(status.getAvailableEssence() - blessingToGrant);

        // ë ˆë²¨ì—… ì²´í¬
        boolean leveledUp = false;
        int previousLevel = status.getCurrentLevel();
        
        while (canLevelUp(status)) {
            levelUp(status);
            leveledUp = true;
        }

        statusRepository.save(status);

        return new LevelUpResult(
            status.getCurrentLevel(),
            previousLevel,
            leveledUp,
            expGained,
            status.getExperience(),
            getRequiredExpForNextLevel(status.getCurrentLevel())
        );
    }

    private boolean canLevelUp(WorldTreeStatus status) {
        int requiredExp = getRequiredExpForNextLevel(status.getCurrentLevel());
        return status.getExperience() >= requiredExp && status.getCurrentLevel() < 30;
    }

    private void levelUp(WorldTreeStatus status) {
        status.setCurrentLevel(status.getCurrentLevel() + 1);
    }

    private int getRequiredExpForNextLevel(int currentLevel) {
        // Medium Slow ê²½í—˜ì¹˜ ê³¡ì„ : nÂ³ Ã— 0.8 + n Ã— 50
        int nextLevel = currentLevel + 1;
        return (int) (Math.pow(nextLevel, 3) * 0.8 + nextLevel * 50);
    }

    private WorldTreeStatus initializeNewUser(Long userId) {
        WorldTreeStatus status = new WorldTreeStatus();
        status.setUserId(userId);
        status.setCurrentLevel(1);
        status.setExperience(0);
        status.setAvailableEssence(100); // íŠœí† ë¦¬ì–¼ìš© ì´ˆê¸° ì¶•ë³µ
        return statusRepository.save(status);
    }

    private LevelUpResult getCurrentLevelUpResult(WorldTreeStatus status, boolean leveledUp) {
        return new LevelUpResult(
            status.getCurrentLevel(),
            status.getCurrentLevel(),
            leveledUp,
            0,
            status.getExperience(),
            getRequiredExpForNextLevel(status.getCurrentLevel())
        );
    }
}
```

#### 5.2.3 ì •ë ¹ ìƒì„± ì‹œìŠ¤í…œ

**êµ¬í˜„ íŒŒì¼**: `SpiritController.java`, `SpiritService.java`

**ì£¼ìš” ê¸°ëŠ¥**:
- ë ˆë²¨ 2 ë‹¬ì„± ì‹œ ì •ë ¹ ìƒì„± ê°€ëŠ¥
- 5ê°€ì§€ ì†ì„± ì„ íƒ (ë¶ˆ, ë¬¼, í’€, ë¹›, ì–´ë‘ )
- ì„±ê²© ëœë¤ ë¶€ì—¬
- ì´ˆê¸° ëŠ¥ë ¥ì¹˜ ì„¤ì •

**ì†ŒìŠ¤ì½”ë“œ**:

```java
package com.soi.spirit.service;

import com.soi.spirit.entity.Spirit;
import com.soi.spirit.entity.SpiritType;
import com.soi.spirit.enums.Personality;
import com.soi.spirit.enums.SpiritElement;
import com.soi.spirit.repository.SpiritRepository;
import com.soi.spirit.repository.SpiritTypeRepository;
import com.soi.worldtree.entity.WorldTreeStatus;
import com.soi.worldtree.repository.WorldTreeStatusRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.Arrays;
import java.util.List;
import java.util.Random;

@Service
@Transactional
public class SpiritService {

    @Autowired
    private SpiritRepository spiritRepository;

    @Autowired
    private SpiritTypeRepository spiritTypeRepository;

    @Autowired
    private WorldTreeStatusRepository worldTreeStatusRepository;

    /**
     * ì •ë ¹ì„ ìƒì„±í•©ë‹ˆë‹¤.
     */
    public Spirit createSpirit(Long userId, String element, String name) {
        // ë ˆë²¨ 2 ì´ìƒì¸ì§€ í™•ì¸
        WorldTreeStatus status = worldTreeStatusRepository.findByUserId(userId)
                .orElseThrow(() -> new RuntimeException("ì„¸ê³„ìˆ˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
        
        if (status.getCurrentLevel() < 2) {
            throw new RuntimeException("ë ˆë²¨ 2 ì´ìƒì´ì–´ì•¼ ì •ë ¹ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }

        // ì •ë ¹ íƒ€ì… ì¡°íšŒ
        SpiritType spiritType = spiritTypeRepository.findByElement(element)
                .orElseThrow(() -> new RuntimeException("ì •ë ¹ íƒ€ì…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));

        // ì„±ê²© ëœë¤ ì„ íƒ
        Personality personality = getRandomPersonality();

        // ì •ë ¹ ìƒì„±
        Spirit spirit = new Spirit();
        spirit.setUserId(userId);
        spirit.setSpiritType(spiritType.getName());
        spirit.setName(name != null && !name.trim().isEmpty() ? name : spiritType.getName());
        spirit.setLevel(1);
        spirit.setExperience(0);
        spirit.setIntimacy(1);
        spirit.setPersonality(personality.name());
        spirit.setEvolutionStage(0);

        // ì´ˆê¸° ëŠ¥ë ¥ì¹˜ ì„¤ì • (ì •ë ¹ íƒ€ì…ì˜ ê¸°ë³¸ ëŠ¥ë ¥ì¹˜ + ì„±ê²© ë³´ì •)
        setInitialStats(spirit, spiritType, personality);

        // ìƒíƒœ ì´ˆê¸°í™”
        spirit.setHealthStatus("ê±´ê°•");
        spirit.setHappiness(50);
        spirit.setMood("ë³´í†µ");
        spirit.setHunger(50);
        spirit.setEnergy(100);

        return spiritRepository.save(spirit);
    }

    private Personality getRandomPersonality() {
        List<Personality> personalities = Arrays.asList(Personality.values());
        Random random = new Random();
        return personalities.get(random.nextInt(personalities.size()));
    }

    private void setInitialStats(Spirit spirit, SpiritType spiritType, Personality personality) {
        // ê¸°ë³¸ ëŠ¥ë ¥ì¹˜
        spirit.setRangedAttack(spiritType.getBaseRangedAttack());
        spirit.setMeleeAttack(spiritType.getBaseMeleeAttack());
        spirit.setRangedDefense(spiritType.getBaseRangedDefense());
        spirit.setMeleeDefense(spiritType.getBaseMeleeDefense());
        spirit.setSpeed(spiritType.getBaseSpeed());

        // ì„±ê²©ë³„ ë³´ì •
        applyPersonalityBonus(spirit, personality);
    }

    private void applyPersonalityBonus(Spirit spirit, Personality personality) {
        switch (personality) {
            case ê³ ì§‘:
                spirit.setMeleeAttack(spirit.getMeleeAttack() + 2);
                spirit.setMeleeDefense(spirit.getMeleeDefense() + 1);
                break;
            case ì¡°ì‹¬:
                spirit.setRangedDefense(spirit.getRangedDefense() + 2);
                spirit.setMeleeDefense(spirit.getMeleeDefense() + 1);
                break;
            case ì¥ë‚œê¾¸ëŸ¬ê¸°:
                spirit.setSpeed(spirit.getSpeed() + 3);
                break;
            case ì˜¨ìˆœ:
                spirit.setRangedAttack(spirit.getRangedAttack() + 1);
                spirit.setRangedDefense(spirit.getRangedDefense() + 2);
                break;
            case ìš©ê°:
                spirit.setRangedAttack(spirit.getRangedAttack() + 2);
                spirit.setMeleeAttack(spirit.getMeleeAttack() + 1);
                break;
        }
    }
}
```

---

## 6. ì†ŒìŠ¤ì½”ë“œ ìƒì„¸ ë¶„ì„

### 6.1 ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤

```java
package com.soi;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.scheduling.annotation.EnableScheduling;

@SpringBootApplication
@EnableScheduling
public class SoiApplication {

    public static void main(String[] args) {
        SpringApplication.run(SoiApplication.class, args);
    }
}
```

**ì„¤ëª…**:
- `@SpringBootApplication`: Spring Boot ìë™ ì„¤ì • í™œì„±í™”
- `@EnableScheduling`: ìŠ¤ì¼€ì¤„ëŸ¬ ê¸°ëŠ¥ í™œì„±í™” (ì •ê¸°ì ì¸ ê²Œì„ ì§„í–‰ ì²˜ë¦¬)

### 6.2 Spring Security ì„¤ì •

```java
package com.soi.config;

import com.soi.user.CustomUserDetailsService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Autowired
    private CustomUserDetailsService userDetailsService;

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/register", "/login", "/css/**", "/js/**", "/images/**").permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form -> form
                .loginPage("/login")
                .defaultSuccessUrl("/home", true)
                .failureUrl("/login?error=true")
                .permitAll()
            )
            .logout(logout -> logout
                .logoutUrl("/logout")
                .logoutSuccessUrl("/login?logout=true")
                .permitAll()
            )
            .csrf(csrf -> csrf.disable()); // ê°œë°œ í™˜ê²½ìš©

        return http.build();
    }

    @Autowired
    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService)
            .passwordEncoder(passwordEncoder());
    }
}
```

### 6.3 ì •ë ¹ ììœ¨ í–‰ë™ ì‹œìŠ¤í…œ

```java
package com.soi.spirit.service;

import com.soi.spirit.entity.Spirit;
import com.soi.spirit.enums.Personality;
import com.soi.spirit.repository.SpiritRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;
import java.util.List;
import java.util.Random;

@Service
@Transactional
public class AutonomousBehaviorService {

    @Autowired
    private SpiritRepository spiritRepository;

    /**
     * ë§¤ 5ë¶„ë§ˆë‹¤ ì •ë ¹ë“¤ì˜ ììœ¨ í–‰ë™ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
     */
    @Scheduled(fixedRate = 300000) // 5ë¶„ = 300,000ms
    public void processAutonomousBehaviors() {
        List<Spirit> spirits = spiritRepository.findAll();
        
        for (Spirit spirit : spirits) {
            updateSpiritStatus(spirit);
            performPersonalityBasedAction(spirit);
        }
    }

    private void updateSpiritStatus(Spirit spirit) {
        // ë°°ê³ í”” ì¦ê°€
        if (spirit.getHunger() < 100) {
            spirit.setHunger(Math.min(100, spirit.getHunger() + 5));
        }

        // ì—ë„ˆì§€ ê°ì†Œ
        if (spirit.getEnergy() > 0) {
            spirit.setEnergy(Math.max(0, spirit.getEnergy() - 2));
        }

        // í–‰ë³µë„ ì—…ë°ì´íŠ¸
        updateHappiness(spirit);

        spirit.setLastActionTime(LocalDateTime.now());
        spiritRepository.save(spirit);
    }

    private void updateHappiness(Spirit spirit) {
        int happiness = spirit.getHappiness();
        
        // ë°°ê³ í””ì´ ë†’ìœ¼ë©´ í–‰ë³µë„ ê°ì†Œ
        if (spirit.getHunger() > 70) {
            happiness = Math.max(0, happiness - 3);
        }
        
        // ì—ë„ˆì§€ê°€ ë‚®ìœ¼ë©´ í–‰ë³µë„ ê°ì†Œ
        if (spirit.getEnergy() < 30) {
            happiness = Math.max(0, happiness - 2);
        }
        
        // ê±´ê°• ìƒíƒœê°€ ë‚˜ì˜ë©´ í–‰ë³µë„ ê°ì†Œ
        if (!"ê±´ê°•".equals(spirit.getHealthStatus())) {
            happiness = Math.max(0, happiness - 5);
        }

        spirit.setHappiness(happiness);
    }

    private void performPersonalityBasedAction(Spirit spirit) {
        Personality personality = Personality.valueOf(spirit.getPersonality());
        Random random = new Random();

        switch (personality) {
            case ê³ ì§‘:
                // ê³ ì§‘: í›ˆë ¨ì„ ì¢‹ì•„í•¨ (ëŠ¥ë ¥ì¹˜ ì†Œí­ ì¦ê°€)
                if (random.nextInt(100) < 30) {
                    spirit.setMeleeAttack(spirit.getMeleeAttack() + 1);
                }
                break;
                
            case ì¡°ì‹¬:
                // ì¡°ì‹¬: ì•ˆì „í•œ ê³³ì— ë¨¸ë¬´ë¦„ (ë°©ì–´ë ¥ ì†Œí­ ì¦ê°€)
                if (random.nextInt(100) < 30) {
                    spirit.setRangedDefense(spirit.getRangedDefense() + 1);
                }
                break;
                
            case ì¥ë‚œê¾¸ëŸ¬ê¸°:
                // ì¥ë‚œê¾¸ëŸ¬ê¸°: í™œë™ì  (ìŠ¤í”¼ë“œ ì¦ê°€, ì—ë„ˆì§€ ì†Œëª¨)
                if (random.nextInt(100) < 40) {
                    spirit.setSpeed(spirit.getSpeed() + 1);
                    spirit.setEnergy(Math.max(0, spirit.getEnergy() - 5));
                }
                break;
                
            case ì˜¨ìˆœ:
                // ì˜¨ìˆœ: ì¹œë°€ë„ ì¦ê°€
                if (random.nextInt(100) < 50 && spirit.getIntimacy() < 10) {
                    spirit.setIntimacy(spirit.getIntimacy() + 1);
                }
                break;
                
            case ìš©ê°:
                // ìš©ê°: ê³µê²©ë ¥ ì¦ê°€, ìœ„í—˜ ê°ìˆ˜
                if (random.nextInt(100) < 35) {
                    spirit.setRangedAttack(spirit.getRangedAttack() + 1);
                    if (random.nextInt(100) < 20) {
                        spirit.setHealthStatus("ê°€ë²¼ìš´ ìƒì²˜");
                    }
                }
                break;
        }
    }
}
```

---

## 7. í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### 7.1 í…œí”Œë¦¿ êµ¬ì¡°

í”„ë¡œì íŠ¸ëŠ” Thymeleafë¥¼ ì‚¬ìš©í•œ ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤.

**ì£¼ìš” í…œí”Œë¦¿ íŒŒì¼**:
- `base.html`: ê¸°ë³¸ ë ˆì´ì•„ì›ƒ í…œí”Œë¦¿
- `login.html`: ë¡œê·¸ì¸ í˜ì´ì§€
- `register.html`: íšŒì›ê°€ì… í˜ì´ì§€
- `home.html`: í™ˆ í˜ì´ì§€
- `world.html`: ì›”ë“œë§µ
- `world-tree.html`: ì„¸ê³„ìˆ˜ì˜ ì‹¬ì¥
- `spirit-village.html`: ì •ë ¹ ë§ˆì„
- `spirit-create.html`: ì •ë ¹ ìƒì„±
- `explorer-trail.html`: íƒí—˜ì˜ ê¸¸ (ë˜ì „)
- `spirit-square.html`: ì •ë ¹ ê´‘ì¥ (WebSocket)

### 7.2 JavaScript êµ¬ì¡°

**ì£¼ìš” JavaScript íŒŒì¼**:
- `world.js`: ì›”ë“œë§µ ë¡œì§
- `world-tree.js`: ì„¸ê³„ìˆ˜ ë ˆë²¨ì—… ë¡œì§
- `spirit-village.js`: ì •ë ¹ ë§ˆì„ ê´€ë¦¬
- `spirit-square-websocket.js`: WebSocket í†µì‹ 
- `tutorial.js`: íŠœí† ë¦¬ì–¼ ì‹œìŠ¤í…œ

### 7.3 CSS êµ¬ì¡°

**ì£¼ìš” CSS íŒŒì¼**:
- `world.css`: ì›”ë“œë§µ ìŠ¤íƒ€ì¼
- `world-tree.css`: ì„¸ê³„ìˆ˜ ìŠ¤íƒ€ì¼
- `spirit-village.css`: ì •ë ¹ ë§ˆì„ ìŠ¤íƒ€ì¼
- `login.css`: ë¡œê·¸ì¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼

---

## 8. ë³´ì•ˆ ë° ì¸ì¦ ì‹œìŠ¤í…œ

### 8.1 ì¸ì¦ ë°©ì‹

- **ì„¸ì…˜ ê¸°ë°˜ ì¸ì¦**: Spring Securityì˜ ê¸°ë³¸ ì„¸ì…˜ ê´€ë¦¬ ì‚¬ìš©
- **ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”**: BCrypt ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
- **CSRF ë³´í˜¸**: ê°œë°œ í™˜ê²½ì—ì„œëŠ” ë¹„í™œì„±í™”, í”„ë¡œë•ì…˜ì—ì„œëŠ” í™œì„±í™” ê¶Œì¥

### 8.2 ë³´ì•ˆ ì„¤ì •

```java
// SecurityConfig.javaì—ì„œ ì£¼ìš” ë³´ì•ˆ ì„¤ì •
- ì¸ì¦ì´ í•„ìš”í•œ ê²½ë¡œ: ëª¨ë“  ê²½ë¡œ (ë¡œê·¸ì¸/íšŒì›ê°€ì… ì œì™¸)
- ë¡œê·¸ì¸ í˜ì´ì§€: /login
- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ: /homeìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- ë¡œê·¸ì•„ì›ƒ: /logout
```

---

## 9. ë°°í¬ ë° ìš´ì˜

### 9.1 Docker ì„¤ì •

**Dockerfile**:

```dockerfile
# Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ Dockerfile
FROM maven:3.9-eclipse-temurin-17 AS build

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app

# pom.xml ë³µì‚¬ (ìºì‹œ ìµœì í™”)
COPY pom.xml .

# ì˜ì¡´ì„± ë‹¤ìš´ë¡œë“œ (ë ˆì´ì–´ ìºì‹±)
RUN mvn dependency:go-offline -B || true

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY src ./src

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
RUN mvn clean package -DskipTests -B

# ëŸ°íƒ€ì„ ì´ë¯¸ì§€
FROM eclipse-temurin:17-jre-alpine

WORKDIR /app

# ë¹Œë“œëœ JAR íŒŒì¼ ë³µì‚¬
COPY --from=build /app/target/*.jar app.jar

# ë°ì´í„° ë””ë ‰í† ë¦¬ ìƒì„± (H2 ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ìš©)
RUN mkdir -p /app/data

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
ENV SPRING_PROFILES_ACTIVE=prod
ENV JAVA_OPTS="-Xms256m -Xmx512m -XX:+UseG1GC"

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

**docker-compose.yml**:

```yaml
version: '3.8'

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: soi-backend
    environment:
      SPRING_PROFILES_ACTIVE: "prod"
      SERVER_PORT: "8080"
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped
    networks:
      - soi-network

  nginx:
    image: nginx:alpine
    container_name: soi-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /opt/soi/nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
      - /opt/soi/nginx/ssl:/etc/nginx/ssl:ro
      - /opt/soi/deploy-package/logs/nginx:/var/log/nginx
    depends_on:
      backend:
        condition: service_started
    restart: unless-stopped
    networks:
      - soi-network

networks:
  soi-network:
    driver: bridge
```

### 9.2 Nginx ì„¤ì •

**default.conf**:

```nginx
# HTTP ì„œë²„ - HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
server {
    listen 80;
    listen [::]:80;
    server_name irosecon.com www.irosecon.com;
    
    # Let's Encrypt ì¸ì¦ì„ ìœ„í•œ ê²½ë¡œ
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }
    
    # HTTPì—ì„œ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    location / {
        return 301 https://$server_name$request_uri;
    }
}

# HTTPS ì„œë²„
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name irosecon.com www.irosecon.com;

    # SSL ì¸ì¦ì„œ ì„¤ì •
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    
    # SSL ë³´ì•ˆ ì„¤ì •
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;

    client_max_body_size 20M;

    # ë¡œê·¸ ì„¤ì •
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # ê¸°ë³¸ ìœ„ì¹˜
    location / {
        proxy_pass http://soi-backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Port $server_port;
        
        # WebSocket ì§€ì›
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # íƒ€ì„ì•„ì›ƒ ì„¤ì •
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # ë²„í¼ë§ ì„¤ì •
        proxy_buffering off;
        proxy_request_buffering off;
    }

    # ì •ì  íŒŒì¼ ìºì‹±
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg)$ {
        proxy_pass http://soi-backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 9.3 ë°°í¬ í”„ë¡œì„¸ìŠ¤

1. **ë¡œì»¬ ë¹Œë“œ**: `mvn clean package`
2. **Docker ì´ë¯¸ì§€ ë¹Œë“œ**: `docker-compose build`
3. **ì»¨í…Œì´ë„ˆ ì‹¤í–‰**: `docker-compose up -d`
4. **SSL ì¸ì¦ì„œ ë°œê¸‰**: Let's Encrypt ì‚¬ìš©
5. **ëª¨ë‹ˆí„°ë§**: ë¡œê·¸ í™•ì¸ ë° í—¬ìŠ¤ ì²´í¬

---

## 10. í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### 10.1 ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

| í…ŒìŠ¤íŠ¸ í•­ëª© | ê²°ê³¼ | ë¹„ê³  |
|------------|------|------|
| ì‚¬ìš©ì íšŒì›ê°€ì… | âœ… í†µê³¼ | ì•„ì´ë”” ì¤‘ë³µ ì²´í¬, ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ |
| ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ | âœ… í†µê³¼ | ì„¸ì…˜ ê´€ë¦¬ ì •ìƒ ì‘ë™ |
| ì„¸ê³„ìˆ˜ ë ˆë²¨ì—… | âœ… í†µê³¼ | ê²½í—˜ì¹˜ ê³„ì‚° ë° ë ˆë²¨ì—… ë¡œì§ ê²€ì¦ |
| ì •ë ¹ ìƒì„± | âœ… í†µê³¼ | ë ˆë²¨ 2 ì¡°ê±´ í™•ì¸, ì†ì„± ì„ íƒ |
| ì •ë ¹ ì„±ì¥ | âœ… í†µê³¼ | ê²½í—˜ì¹˜ íšë“ ë° ë ˆë²¨ì—… |
| ë˜ì „ ì „íˆ¬ | âœ… í†µê³¼ | ì „íˆ¬ ë¡œì§ ë° ë³´ìƒ ì§€ê¸‰ |
| WebSocket í†µì‹  | âœ… í†µê³¼ | ì •ë ¹ ê´‘ì¥ ì‹¤ì‹œê°„ ì±„íŒ… |

### 10.2 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

- **ì‘ë‹µ ì‹œê°„**: í‰ê·  200ms ì´í•˜
- **ë™ì‹œ ì ‘ì†ì**: 100ëª… ì´ìƒ ì§€ì› ê°€ëŠ¥
- **ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬**: ìµœì í™” ì™„ë£Œ

### 10.3 ë³´ì•ˆ í…ŒìŠ¤íŠ¸

- **SQL Injection**: ë°©ì–´ ì™„ë£Œ (JPA ì‚¬ìš©)
- **XSS ê³µê²©**: ë°©ì–´ ì™„ë£Œ (Thymeleaf ìë™ ì´ìŠ¤ì¼€ì´í”„)
- **CSRF ê³µê²©**: ê°œë°œ í™˜ê²½ ë¹„í™œì„±í™”, í”„ë¡œë•ì…˜ í™œì„±í™” ê¶Œì¥

---

## 11. ê²°ë¡  ë° í–¥í›„ ê³„íš

### 11.1 í”„ë¡œì íŠ¸ ì™„ì„±ë„

ë³¸ í”„ë¡œì íŠ¸ëŠ” ê³„íšëœ ëª¨ë“  ê¸°ëŠ¥ì„ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. ì‚¬ìš©ì ì¸ì¦ë¶€í„° ì •ë ¹ ì„±ì¥, ì „íˆ¬, ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ê¹Œì§€ ì™„ì „í•œ ê²Œì„ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤.

### 11.2 ì£¼ìš” ì„±ê³¼

1. **ì™„ì „í•œ ê²Œì„ ì‹œìŠ¤í…œ êµ¬ì¶•**: ì •ë ¹ ì„±ì¥ RPGì˜ í•µì‹¬ ê¸°ëŠ¥ ëª¨ë‘ êµ¬í˜„
2. **í™•ì¥ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜**: ë„ë©”ì¸ë³„ íŒ¨í‚¤ì§€ ë¶„ë¦¬ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
3. **ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„**: WebSocketì„ í™œìš©í•œ ì •ë ¹ ê´‘ì¥ ê¸°ëŠ¥
4. **í”„ë¡œë•ì…˜ ë°°í¬ ì™„ë£Œ**: Docker ë° Nginxë¥¼ í™œìš©í•œ ì•ˆì •ì ì¸ ë°°í¬

### 11.3 í–¥í›„ ê°œì„  ê³„íš

#### ë‹¨ê¸° (1-2ê°œì›”)
- [ ] MySQL/PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] Redis ìºì‹œ ì‹œìŠ¤í…œ ë„ì…
- [ ] ëª¨ë°”ì¼ ë°˜ì‘í˜• ë””ìì¸ ê°œì„ 
- [ ] ì¶”ê°€ ë˜ì „ ë° ë³´ìŠ¤ ì „íˆ¬

#### ì¤‘ê¸° (3-6ê°œì›”)
- [ ] PvP ì „íˆ¬ ì‹œìŠ¤í…œ
- [ ] ê¸¸ë“œ ì‹œìŠ¤í…œ
- [ ] ì •ë ¹ êµë°° ì‹œìŠ¤í…œ
- [ ] ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ í™•ì¥

#### ì¥ê¸° (6ê°œì›” ì´ìƒ)
- [ ] ëª¨ë°”ì¼ ì•± ê°œë°œ (React Native)
- [ ] ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤ í™•ì¥
- [ ] AI ê¸°ë°˜ ì •ë ¹ í–‰ë™ ê°œì„ 
- [ ] ë¸”ë¡ì²´ì¸ ì—°ë™ (NFT ì •ë ¹)

### 11.4 ê¸°ìˆ  ë¶€ì±„ ë° ê°œì„  ì‚¬í•­

1. **ë°ì´í„°ë² ì´ìŠ¤**: H2 â†’ MySQL/PostgreSQL ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš”
2. **ìºì‹±**: Redis ë„ì…ìœ¼ë¡œ ì„±ëŠ¥ ê°œì„ 
3. **ëª¨ë‹ˆí„°ë§**: Prometheus + Grafana ë„ì…
4. **ë¡œê¹…**: ELK Stack ë„ì… ê²€í† 
5. **í…ŒìŠ¤íŠ¸ ì½”ë“œ**: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€

---

## ë¶€ë¡ A: ì „ì²´ ì†ŒìŠ¤ì½”ë“œ

### A.1 ì£¼ìš” ì—”í‹°í‹° í´ë˜ìŠ¤

[ì—¬ê¸°ì— ì£¼ìš” ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ì „ì²´ ì†ŒìŠ¤ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤]

### A.2 ì£¼ìš” ì„œë¹„ìŠ¤ í´ë˜ìŠ¤

[ì—¬ê¸°ì— ì£¼ìš” ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ì˜ ì „ì²´ ì†ŒìŠ¤ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤]

### A.3 ì£¼ìš” ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤

[ì—¬ê¸°ì— ì£¼ìš” ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ì˜ ì „ì²´ ì†ŒìŠ¤ì½”ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤]

---

## ë¶€ë¡ B: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### B.1 í…Œì´ë¸” ìƒì„± ìŠ¤í¬ë¦½íŠ¸

```sql
-- Users í…Œì´ë¸”
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Spirits í…Œì´ë¸”
CREATE TABLE spirits (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    spirit_type VARCHAR(50) NOT NULL,
    evolution_stage INT NOT NULL DEFAULT 0,
    name VARCHAR(50),
    level INT NOT NULL DEFAULT 1,
    experience INT NOT NULL DEFAULT 0,
    intimacy INT NOT NULL DEFAULT 1,
    personality VARCHAR(20) NOT NULL,
    ranged_attack INT NOT NULL DEFAULT 0,
    melee_attack INT NOT NULL DEFAULT 0,
    ranged_defense INT NOT NULL DEFAULT 0,
    melee_defense INT NOT NULL DEFAULT 0,
    speed INT NOT NULL DEFAULT 0,
    health_status VARCHAR(50) DEFAULT 'ê±´ê°•',
    happiness INT NOT NULL DEFAULT 50,
    mood VARCHAR(50) DEFAULT 'ë³´í†µ',
    hunger INT NOT NULL DEFAULT 50,
    energy INT NOT NULL DEFAULT 100,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_action_time TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- World Tree Status í…Œì´ë¸”
CREATE TABLE world_tree_status (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNIQUE NOT NULL,
    current_level INT NOT NULL DEFAULT 1,
    experience BIGINT NOT NULL DEFAULT 0,
    available_essence BIGINT NOT NULL DEFAULT 0,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

## ë¶€ë¡ C: API ë¬¸ì„œ

### C.1 REST API ì—”ë“œí¬ì¸íŠ¸

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… | ì¸ì¦ í•„ìš” |
|--------|------|------|----------|
| GET | `/login` | ë¡œê·¸ì¸ í˜ì´ì§€ | âŒ |
| POST | `/login/process` | ë¡œê·¸ì¸ ì²˜ë¦¬ | âŒ |
| GET | `/register` | íšŒì›ê°€ì… í˜ì´ì§€ | âŒ |
| POST | `/register` | íšŒì›ê°€ì… ì²˜ë¦¬ | âŒ |
| GET | `/home` | í™ˆ í˜ì´ì§€ | âœ… |
| GET | `/world` | ì›”ë“œë§µ | âœ… |
| GET | `/world-tree` | ì„¸ê³„ìˆ˜ì˜ ì‹¬ì¥ | âœ… |
| POST | `/world-tree/api/blessing/grant` | ì •ë ¹ì˜ ì¶•ë³µ ë¶€ì—¬ | âœ… |
| GET | `/spirit/village` | ì •ë ¹ ë§ˆì„ | âœ… |
| POST | `/spirit/create` | ì •ë ¹ ìƒì„± | âœ… |
| GET | `/explorer/trail` | íƒí—˜ì˜ ê¸¸ | âœ… |
| POST | `/explorer/api/start-battle` | ì „íˆ¬ ì‹œì‘ | âœ… |

### C.2 ì£¼ìš” ì»¨íŠ¸ë¡¤ëŸ¬ ì†ŒìŠ¤ì½”ë“œ

#### C.2.1 SpiritController.java

```java
package com.soi.spirit.controller;

import com.soi.spirit.entity.SpiritType;
import com.soi.spirit.entity.Spirit;
import com.soi.spirit.service.SpiritService;
import com.soi.spirit.service.LifecycleService;
import com.soi.spirit.service.SkillService;
import com.soi.spirit.repository.SkillRepository;
import com.soi.user.User;
import com.soi.user.UserRepository;
import com.soi.worldtree.service.WorldTreeService;
import com.soi.game.service.GameTimeService;
import com.soi.game.entity.GameTime;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Map;
import java.util.HashMap;
import java.util.stream.Collectors;

@Controller
@RequestMapping("/spirit")
public class SpiritController {

    private final WorldTreeService worldTreeService;
    private final UserRepository userRepository;
    private final SpiritService spiritService;
    private final GameTimeService gameTimeService;
    private final LifecycleService lifecycleService;
    private final SkillService skillService;
    private final SkillRepository skillRepository;

    @Autowired
    public SpiritController(WorldTreeService worldTreeService, 
                           UserRepository userRepository,
                           SpiritService spiritService,
                           GameTimeService gameTimeService,
                           LifecycleService lifecycleService,
                           SkillService skillService,
                           SkillRepository skillRepository) {
        this.worldTreeService = worldTreeService;
        this.userRepository = userRepository;
        this.spiritService = spiritService;
        this.gameTimeService = gameTimeService;
        this.lifecycleService = lifecycleService;
        this.skillService = skillService;
        this.skillRepository = skillRepository;
    }

    /**
     * ì •ë ¹ ìƒì„± í˜ì´ì§€
     * ë ˆë²¨ 2 ì´ìƒì¼ ë•Œë§Œ ì ‘ê·¼ ê°€ëŠ¥
     */
    @GetMapping("/create")
    public String createSpirit(Model model, Authentication authentication) {
        try {
            Long userId = getUserId(authentication);
            
            // ì •ë ¹ ìƒì„± ê¸°ëŠ¥ ì–¸ë½ ì—¬ë¶€ í™•ì¸
            boolean unlocked = false;
            try {
                unlocked = worldTreeService.isSpiritCreationUnlocked(userId);
            } catch (Exception e) {
                model.addAttribute("error", "ì„¸ê³„ìˆ˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return "spirit-create";
            }
            
            if (!unlocked) {
                return "redirect:/world-tree/core?error=spirit_creation_locked&message=ì •ë ¹ ìƒì„±ì„ ìœ„í•´ì„œëŠ” ì„¸ê³„ìˆ˜ ë ˆë²¨ 2 ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤.";
            }
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ ì •ë ¹ íƒ€ì… ì¡°íšŒ
            var worldTreeInfo = worldTreeService.getWorldTreeInfo(userId);
            if (worldTreeInfo == null || worldTreeInfo.getCurrentLevel() == null) {
                model.addAttribute("error", "ì„¸ê³„ìˆ˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                model.addAttribute("unlocked", false);
                model.addAttribute("availableTypes", List.<SpiritType>of());
                model.addAttribute("currentCount", 0L);
                model.addAttribute("maxCount", 0);
                model.addAttribute("canCreate", false);
                return "spirit-create";
            }
            
            int userLevel = worldTreeInfo.getCurrentLevel();
            List<SpiritType> availableTypes = spiritService.getAvailableSpiritTypes(userId, userLevel);
            
            // í˜„ì¬ ì†Œìœ  ì •ë ¹ ìˆ˜ ë° ìµœëŒ€ ì†Œìœ  ìˆ˜
            long currentCount = spiritService.getCurrentSpiritCount(userId);
            int maxCount = spiritService.getMaxSpiritCount(userId);
            
            model.addAttribute("unlocked", unlocked);
            model.addAttribute("availableTypes", availableTypes);
            model.addAttribute("currentCount", currentCount);
            model.addAttribute("maxCount", maxCount);
            model.addAttribute("canCreate", currentCount < maxCount && !availableTypes.isEmpty());
            
        } catch (Exception e) {
            model.addAttribute("error", "ì •ë ¹ ìƒì„± í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.getMessage());
            model.addAttribute("unlocked", false);
            model.addAttribute("availableTypes", List.<SpiritType>of());
            model.addAttribute("currentCount", 0L);
            model.addAttribute("maxCount", 0);
            model.addAttribute("canCreate", false);
        }
        
        return "spirit-create";
    }

    /**
     * ì •ë ¹ ìƒì„± ì²˜ë¦¬
     */
    @PostMapping("/create")
    public String createSpiritPost(@RequestParam(required = false) String spiritTypeCode,
                                   @RequestParam(required = false) String name,
                                   Authentication authentication,
                                   Model model) {
        try {
            if (spiritTypeCode == null || spiritTypeCode.trim().isEmpty()) {
                model.addAttribute("error", "ì •ë ¹ íƒ€ì…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
                return createSpirit(model, authentication);
            }
            
            Long userId = getUserId(authentication);
            spiritService.createSpirit(userId, spiritTypeCode, name);
            return "redirect:/spirit/village?created=true";
        } catch (IllegalArgumentException e) {
            model.addAttribute("error", e.getMessage());
            return createSpirit(model, authentication);
        } catch (Exception e) {
            model.addAttribute("error", "ì •ë ¹ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.getMessage());
            return createSpirit(model, authentication);
        }
    }

    private Long getUserId(Authentication authentication) {
        if (authentication != null && authentication.isAuthenticated()) {
            String username = authentication.getName();
            User user = userRepository.findByUsername(username)
                    .orElseThrow(() -> new RuntimeException("User not found: " + username));
            return user.getId();
        }
        throw new RuntimeException("User not authenticated");
    }
}
```

#### C.2.2 WorldTreeController.java

```java
package com.soi.worldtree.controller;

import com.soi.user.User;
import com.soi.user.UserRepository;
import com.soi.worldtree.dto.BlessingGrantRequest;
import com.soi.worldtree.dto.EssencePulseRequest;
import com.soi.worldtree.dto.LevelUpResult;
import com.soi.worldtree.dto.WorldTreeInfo;
import com.soi.worldtree.service.WorldTreeService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

@Controller
@RequestMapping("/world-tree")
public class WorldTreeController {

    private final WorldTreeService worldTreeService;
    private final UserRepository userRepository;

    @Autowired
    public WorldTreeController(WorldTreeService worldTreeService, UserRepository userRepository) {
        this.worldTreeService = worldTreeService;
        this.userRepository = userRepository;
    }

    /**
     * ì„¸ê³„ìˆ˜ ì½”ì–´ í˜ì´ì§€
     */
    @GetMapping("/core")
    public String core(@RequestParam(required = false) String error,
                       @RequestParam(required = false) String message,
                       Model model, Authentication authentication) {
        Long userId = getUserId(authentication);
        WorldTreeInfo info = worldTreeService.getWorldTreeInfo(userId);
        model.addAttribute("worldTreeInfo", info);
        
        if (error != null) {
            model.addAttribute("error", error);
        }
        if (message != null) {
            model.addAttribute("message", message);
        }
        
        return "world-tree";
    }

    /**
     * ì •ë ¹ì˜ ì¶•ë³µì„ ê²½í—˜ì¹˜ë¡œ ë¶€ì—¬í•˜ëŠ” API
     */
    @PostMapping("/api/blessing/grant")
    @ResponseBody
    public ResponseEntity<LevelUpResult> grantBlessingToExp(
            @RequestBody BlessingGrantRequest request,
            Authentication authentication) {
        Long userId = getUserId(authentication);
        LevelUpResult result = worldTreeService.grantBlessingToExp(userId, request);
        return ResponseEntity.ok(result);
    }

    private Long getUserId(Authentication authentication) {
        if (authentication != null && authentication.isAuthenticated()) {
            String username = authentication.getName();
            User user = userRepository.findByUsername(username)
                    .orElseThrow(() -> new RuntimeException("User not found: " + username));
            return user.getId();
        }
        throw new RuntimeException("User not authenticated");
    }
}
```

#### C.2.3 ExplorerController.java

```java
package com.soi.explorer.controller;

import com.soi.explorer.entity.DungeonProgress;
import com.soi.explorer.entity.DungeonStage;
import com.soi.explorer.service.CombatService;
import com.soi.explorer.service.DungeonService;
import com.soi.spirit.entity.Spirit;
import com.soi.spirit.service.SpiritService;
import com.soi.user.User;
import com.soi.user.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Controller
@RequestMapping("/explorer")
public class ExplorerController {

    private final UserRepository userRepository;
    private final DungeonService dungeonService;
    private final CombatService combatService;
    private final SpiritService spiritService;

    @Autowired
    public ExplorerController(UserRepository userRepository,
                             DungeonService dungeonService,
                             CombatService combatService,
                             SpiritService spiritService) {
        this.userRepository = userRepository;
        this.dungeonService = dungeonService;
        this.combatService = combatService;
        this.spiritService = spiritService;
    }

    /**
     * íƒí—˜ê°€ì˜ ê¸¸ (ì •ë ¹ ë˜ì „) ë©”ì¸ í˜ì´ì§€
     */
    @GetMapping("/trail")
    public String trail(Model model, Authentication authentication) {
        try {
            if (authentication == null || !authentication.isAuthenticated()) {
                model.addAttribute("error", "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                model.addAttribute("stages", List.of());
                model.addAttribute("progressMap", new HashMap<>());
                model.addAttribute("spirits", List.of());
                return "explorer-trail";
            }
            
            Long userId = getUserId(authentication);
            
            // ìŠ¤í…Œì´ì§€ ëª©ë¡ ì¡°íšŒ
            List<DungeonStage> stages = dungeonService.getAllStages();
            
            // ì‚¬ìš©ìì˜ ì§„í–‰ ìƒíƒœ ì¡°íšŒ
            Map<Integer, DungeonProgress> progressMap = dungeonService.getUserProgress(userId);
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ ì •ë ¹ ëª©ë¡
            List<Spirit> spirits = spiritService.getUserSpirits(userId);
            spirits = spirits.stream()
                    .filter(s -> s != null && 
                            (s.getEvolutionInProgress() == null || !s.getEvolutionInProgress())
                            && (s.getIsRetired() == null || !s.getIsRetired()))
                    .collect(java.util.stream.Collectors.toList());
            
            model.addAttribute("stages", stages);
            model.addAttribute("progressMap", progressMap);
            model.addAttribute("spirits", spirits);
            
        } catch (Exception e) {
            model.addAttribute("error", "íƒí—˜ê°€ì˜ ê¸¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + e.getMessage());
            model.addAttribute("stages", List.of());
            model.addAttribute("progressMap", new HashMap<>());
            model.addAttribute("spirits", List.of());
        }
        
        return "explorer-trail";
    }

    /**
     * ë˜ì „ ì „íˆ¬ ì‹œì‘ API
     */
    @PostMapping("/api/start-battle")
    @ResponseBody
    public ResponseEntity<Map<String, Object>> startBattle(
            @RequestParam Long spiritId,
            @RequestParam Integer stageNumber,
            Authentication authentication) {
        
        try {
            Long userId = getUserId(authentication);
            
            // ì •ë ¹ ì†Œìœ  í™•ì¸
            spiritService.getSpirit(spiritId, userId)
                    .orElseThrow(() -> new IllegalArgumentException("ì •ë ¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
            
            // ìŠ¤í…Œì´ì§€ ì ê¸ˆ í™•ì¸
            if (dungeonService.isStageLocked(userId, stageNumber)) {
                Map<String, Object> response = new HashMap<>();
                response.put("success", false);
                response.put("message", "ì´ì „ ìŠ¤í…Œì´ì§€ë¥¼ ë¨¼ì € í´ë¦¬ì–´í•´ì•¼ í•©ë‹ˆë‹¤.");
                return ResponseEntity.badRequest().body(response);
            }
            
            // ì „íˆ¬ ìˆ˜í–‰
            CombatService.CombatResult result = dungeonService.startBattle(userId, spiritId, stageNumber);
            
            Map<String, Object> response = new HashMap<>();
            response.put("success", true);
            response.put("victory", result.isVictory());
            response.put("rounds", result.getRounds());
            response.put("finalPlayerEnergy", result.getFinalPlayerEnergy());
            
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            Map<String, Object> response = new HashMap<>();
            response.put("success", false);
            response.put("message", e.getMessage());
            return ResponseEntity.badRequest().body(response);
        }
    }

    private Long getUserId(Authentication authentication) {
        if (authentication != null && authentication.isAuthenticated()) {
            String username = authentication.getName();
            User user = userRepository.findByUsername(username)
                    .orElseThrow(() -> new RuntimeException("User not found: " + username));
            return user.getId();
        }
        throw new RuntimeException("User not authenticated");
    }
}
```

---

## ë¶€ë¡ D: ì „íˆ¬ ì‹œìŠ¤í…œ ìƒì„¸ ë¶„ì„

### D.1 ì „íˆ¬ ì•Œê³ ë¦¬ì¦˜

ì „íˆ¬ ì‹œìŠ¤í…œì€ í¬ì¼“ëª¬ìŠ¤í„° ìŠ¤íƒ€ì¼ì˜ í„´ì œ ì „íˆ¬ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

**ì „íˆ¬ íë¦„**:
1. ìŠ¤í”¼ë“œì— ë”°ë¥¸ ê³µê²© ìˆœì„œ ê²°ì •
2. ê° ì •ë ¹ì´ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ ê³µê²©
3. ì†ì„± ìƒì„±ì— ë”°ë¥¸ ë°ë¯¸ì§€ ê³„ì‚°
4. ì—ë„ˆì§€(HP) ê°ì†Œ
5. ìŠ¹ë¦¬ ì¡°ê±´ í™•ì¸

**ì†ì„± ìƒì„±**:
- ë¶ˆ > í’€ > ë¬¼ > ë¶ˆ
- ë¹› <-> ì–´ë‘  (ìƒí˜¸ ê°•í•¨)

**ë°ë¯¸ì§€ ê³„ì‚° ê³µì‹**:
```
ê¸°ë³¸ ë°ë¯¸ì§€ = (ê³µê²©ë ¥ Ã— ê¸°ìˆ  ë°°ìœ¨) - ë°©ì–´ë ¥
ì†ì„± ìƒì„± ë³´ì • = ê¸°ë³¸ ë°ë¯¸ì§€ Ã— ìƒì„± ë°°ìœ¨ (1.5ë°° ë˜ëŠ” 0.5ë°°)
ìµœì¢… ë°ë¯¸ì§€ = ì†ì„± ìƒì„± ë³´ì • Ã— ëœë¤ ë³´ì • (0.85 ~ 1.0)
```

### D.2 CombatService.java ìƒì„¸ ë¶„ì„

```java
package com.soi.explorer.service;

import com.soi.spirit.entity.Spirit;
import com.soi.spirit.entity.Skill;
import com.soi.spirit.entity.SpiritSkill;
import com.soi.spirit.service.SkillService;
import com.soi.spirit.repository.SkillRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.*;

/**
 * ì „íˆ¬ ì„œë¹„ìŠ¤
 */
@Service
public class CombatService {

    private final SkillService skillService;
    private final SkillRepository skillRepository;

    @Autowired
    public CombatService(SkillService skillService, SkillRepository skillRepository) {
        this.skillService = skillService;
        this.skillRepository = skillRepository;
    }

    /**
     * ì „íˆ¬ë¥¼ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
     */
    public CombatResult performCombat(List<Spirit> playerSpirits, List<Spirit> enemies) {
        if (playerSpirits == null || playerSpirits.isEmpty()) {
            throw new IllegalArgumentException("í”Œë ˆì´ì–´ ì •ë ¹ ëª©ë¡ì´ nullì´ê±°ë‚˜ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
        }
        if (enemies == null || enemies.isEmpty()) {
            throw new IllegalArgumentException("ì  ì •ë ¹ ëª©ë¡ì´ nullì´ê±°ë‚˜ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
        }
        
        List<CombatRound> rounds = new ArrayList<>();
        
        // ëª¨ë“  í”Œë ˆì´ì–´ ì •ë ¹ ë³µì œ (ì›ë³¸ ë³´í˜¸)
        List<Spirit> currentPlayers = new ArrayList<>();
        for (Spirit player : playerSpirits) {
            if (player != null) {
                Spirit clonedPlayer = cloneSpirit(player);
                if (clonedPlayer != null) {
                    currentPlayers.add(clonedPlayer);
                }
            }
        }
        
        // ëª¨ë“  ì  ì •ë ¹ ë³µì œ
        List<Spirit> currentEnemies = new ArrayList<>();
        for (Spirit enemy : enemies) {
            if (enemy != null) {
                Spirit clonedEnemy = cloneSpirit(enemy);
                if (clonedEnemy != null) {
                    currentEnemies.add(clonedEnemy);
                }
            }
        }
        
        int roundNumber = 1;
        int maxRounds = 50;
        
        // í”Œë ˆì´ì–´ ì •ë ¹ ì¤‘ í•˜ë‚˜ë¼ë„ ì‚´ì•„ìˆìœ¼ë©´ ê³„ì†
        boolean hasAlivePlayers = currentPlayers.stream()
                .anyMatch(p -> p != null && (p.getEnergy() == null || p.getEnergy() > 0));
        
        while (hasAlivePlayers && !currentEnemies.isEmpty() && roundNumber <= maxRounds) {
            CombatRound round = performRound(currentPlayers, currentEnemies, roundNumber);
            rounds.add(round);
            
            // ì£½ì€ ì  ì œê±°
            currentEnemies.removeIf(e -> e == null || (e.getEnergy() != null && e.getEnergy() <= 0));
            
            // ì£½ì€ í”Œë ˆì´ì–´ ì •ë ¹ ì œê±°
            currentPlayers.removeIf(p -> p == null || (p.getEnergy() != null && p.getEnergy() <= 0));
            
            // í”Œë ˆì´ì–´ ìƒì¡´ í™•ì¸
            hasAlivePlayers = currentPlayers.stream()
                    .anyMatch(p -> p != null && (p.getEnergy() == null || p.getEnergy() > 0));
            
            if (!hasAlivePlayers) {
                break; // ëª¨ë“  í”Œë ˆì´ì–´ ì •ë ¹ íŒ¨ë°°
            }
            
            roundNumber++;
        }
        
        boolean victory = hasAlivePlayers && currentEnemies.isEmpty();
        
        // ë‚¨ì€ í”Œë ˆì´ì–´ ì •ë ¹ë“¤ì˜ í‰ê·  HP ê³„ì‚°
        int totalPlayerEnergy = currentPlayers.stream()
                .filter(p -> p != null && p.getEnergy() != null)
                .mapToInt(Spirit::getEnergy)
                .sum();
        int finalPlayerEnergy = currentPlayers.isEmpty() ? 0 : (totalPlayerEnergy / currentPlayers.size());
        
        return new CombatResult(victory, rounds, finalPlayerEnergy, 0, currentPlayers);
    }

    /**
     * í•œ ë¼ìš´ë“œì˜ ì „íˆ¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
     */
    private CombatRound performRound(List<Spirit> players, List<Spirit> enemies, int roundNumber) {
        CombatRound round = new CombatRound(roundNumber);
        
        // ìŠ¤í”¼ë“œì— ë”°ë¼ ê³µê²© ìˆœì„œ ê²°ì •
        List<Combatant> combatants = new ArrayList<>();
        
        // ëª¨ë“  í”Œë ˆì´ì–´ ì •ë ¹ ì¶”ê°€
        for (Spirit player : players) {
            if (player != null && player.getEnergy() != null && player.getEnergy() > 0) {
                combatants.add(new Combatant(player, true));
            }
        }
        
        // ëª¨ë“  ì  ì •ë ¹ ì¶”ê°€
        for (Spirit enemy : enemies) {
            if (enemy != null && enemy.getEnergy() != null && enemy.getEnergy() > 0) {
                combatants.add(new Combatant(enemy, false));
            }
        }
        
        // ìŠ¤í”¼ë“œ ìˆœìœ¼ë¡œ ì •ë ¬
        combatants.sort((a, b) -> {
            int speedA = a.getSpirit().getSpeed() != null ? a.getSpirit().getSpeed() : 0;
            int speedB = b.getSpirit().getSpeed() != null ? b.getSpirit().getSpeed() : 0;
            return Integer.compare(speedB, speedA); // ë‚´ë¦¼ì°¨ìˆœ
        });
        
        // ê° ì „íˆ¬ì›ì´ ê³µê²© ìˆ˜í–‰
        for (Combatant combatant : combatants) {
            if (combatant.getSpirit().getEnergy() == null || combatant.getSpirit().getEnergy() <= 0) {
                continue; // ì´ë¯¸ ì£½ì€ ì •ë ¹ì€ ìŠ¤í‚µ
            }
            
            // ê³µê²© ëŒ€ìƒ ì„ íƒ
            List<Spirit> targets = combatant.isPlayer() ? enemies : players;
            targets = targets.stream()
                    .filter(t -> t != null && t.getEnergy() != null && t.getEnergy() > 0)
                    .collect(java.util.stream.Collectors.toList());
            
            if (targets.isEmpty()) {
                continue; // ê³µê²©í•  ëŒ€ìƒì´ ì—†ìŒ
            }
            
            // ëœë¤ ëŒ€ìƒ ì„ íƒ
            Spirit target = targets.get(new Random().nextInt(targets.size()));
            
            // ê¸°ìˆ  ì„ íƒ ë° ê³µê²©
            performAttack(combatant.getSpirit(), target, round);
        }
        
        return round;
    }

    /**
     * ê³µê²©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
     */
    private void performAttack(Spirit attacker, Spirit defender, CombatRound round) {
        // ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ìˆ  ì¡°íšŒ
        List<SpiritSkill> skills = skillService.getLearnedSkills(attacker.getId());
        if (skills == null || skills.isEmpty()) {
            // ê¸°ìˆ ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ê³µê²©
            performBasicAttack(attacker, defender, round);
            return;
        }
        
        // ëœë¤ ê¸°ìˆ  ì„ íƒ
        SpiritSkill selectedSkill = skills.get(new Random().nextInt(skills.size()));
        Skill skill = skillRepository.findById(selectedSkill.getSkillId()).orElse(null);
        
        if (skill == null) {
            performBasicAttack(attacker, defender, round);
            return;
        }
        
        // ë°ë¯¸ì§€ ê³„ì‚°
        int damage = calculateDamage(attacker, defender, skill);
        
        // ë°ë¯¸ì§€ ì ìš©
        int currentEnergy = defender.getEnergy() != null ? defender.getEnergy() : 0;
        defender.setEnergy(Math.max(0, currentEnergy - damage));
        
        // ë¼ìš´ë“œì— ì•¡ì…˜ ì¶”ê°€
        round.addAction(new CombatAction(
            attacker.getName(),
            defender.getName(),
            skill.getName(),
            damage,
            defender.getEnergy()
        ));
    }

    /**
     * ê¸°ë³¸ ê³µê²©ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
     */
    private void performBasicAttack(Spirit attacker, Spirit defender, CombatRound round) {
        // ê¸°ë³¸ ê³µê²©ë ¥ ì‚¬ìš©
        int attack = attacker.getRangedAttack() != null ? attacker.getRangedAttack() : 0;
        int defense = defender.getRangedDefense() != null ? defender.getRangedDefense() : 0;
        
        int damage = Math.max(1, attack - defense);
        
        // ëœë¤ ë³´ì • (0.85 ~ 1.0)
        double randomFactor = 0.85 + (new Random().nextDouble() * 0.15);
        damage = (int) (damage * randomFactor);
        
        // ë°ë¯¸ì§€ ì ìš©
        int currentEnergy = defender.getEnergy() != null ? defender.getEnergy() : 0;
        defender.setEnergy(Math.max(0, currentEnergy - damage));
        
        // ë¼ìš´ë“œì— ì•¡ì…˜ ì¶”ê°€
        round.addAction(new CombatAction(
            attacker.getName(),
            defender.getName(),
            "ê¸°ë³¸ ê³µê²©",
            damage,
            defender.getEnergy()
        ));
    }

    /**
     * ë°ë¯¸ì§€ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
     */
    private int calculateDamage(Spirit attacker, Spirit defender, Skill skill) {
        // ê¸°ë³¸ ê³µê²©ë ¥
        int attack = attacker.getRangedAttack() != null ? attacker.getRangedAttack() : 0;
        
        // ê¸°ìˆ  ë°°ìœ¨ ì ìš©
        double skillMultiplier = skill.getPower() != null ? skill.getPower() / 100.0 : 1.0;
        int baseDamage = (int) (attack * skillMultiplier);
        
        // ë°©ì–´ë ¥ ì°¨ê°
        int defense = defender.getRangedDefense() != null ? defender.getRangedDefense() : 0;
        int damage = Math.max(1, baseDamage - defense);
        
        // ì†ì„± ìƒì„± ë³´ì •
        double typeMultiplier = getTypeMultiplier(attacker.getSpiritType(), defender.getSpiritType());
        damage = (int) (damage * typeMultiplier);
        
        // ëœë¤ ë³´ì • (0.85 ~ 1.0)
        double randomFactor = 0.85 + (new Random().nextDouble() * 0.15);
        damage = (int) (damage * randomFactor);
        
        return damage;
    }

    /**
     * ì†ì„± ìƒì„± ë°°ìœ¨ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
     */
    private double getTypeMultiplier(String attackerType, String defenderType) {
        // ë¶ˆ > í’€ > ë¬¼ > ë¶ˆ
        if (attackerType.contains("ë¶ˆ") && defenderType.contains("í’€")) {
            return 1.5;
        }
        if (attackerType.contains("í’€") && defenderType.contains("ë¬¼")) {
            return 1.5;
        }
        if (attackerType.contains("ë¬¼") && defenderType.contains("ë¶ˆ")) {
            return 1.5;
        }
        
        // ì—­ìƒì„±
        if (attackerType.contains("ë¶ˆ") && defenderType.contains("ë¬¼")) {
            return 0.5;
        }
        if (attackerType.contains("í’€") && defenderType.contains("ë¶ˆ")) {
            return 0.5;
        }
        if (attackerType.contains("ë¬¼") && defenderType.contains("í’€")) {
            return 0.5;
        }
        
        // ë¹› <-> ì–´ë‘ 
        if (attackerType.contains("ë¹›") && defenderType.contains("ì–´ë‘ ")) {
            return 1.5;
        }
        if (attackerType.contains("ì–´ë‘ ") && defenderType.contains("ë¹›")) {
            return 1.5;
        }
        
        return 1.0; // ì¼ë°˜
    }

    /**
     * ì •ë ¹ì„ ë³µì œí•©ë‹ˆë‹¤ (ì›ë³¸ ë³´í˜¸).
     */
    private Spirit cloneSpirit(Spirit original) {
        if (original == null) {
            return null;
        }
        
        Spirit clone = new Spirit();
        clone.setId(original.getId());
        clone.setUserId(original.getUserId());
        clone.setSpiritType(original.getSpiritType());
        clone.setName(original.getName());
        clone.setLevel(original.getLevel());
        clone.setExperience(original.getExperience());
        clone.setIntimacy(original.getIntimacy());
        clone.setPersonality(original.getPersonality());
        clone.setRangedAttack(original.getRangedAttack());
        clone.setMeleeAttack(original.getMeleeAttack());
        clone.setRangedDefense(original.getRangedDefense());
        clone.setMeleeDefense(original.getMeleeDefense());
        clone.setSpeed(original.getSpeed());
        clone.setEnergy(original.getEnergy());
        
        return clone;
    }

    // ë‚´ë¶€ í´ë˜ìŠ¤ë“¤
    public static class CombatResult {
        private final boolean victory;
        private final List<CombatRound> rounds;
        private final int finalPlayerEnergy;
        private final int finalEnemyEnergy;
        private final List<Spirit> finalPlayerSpirits;

        public CombatResult(boolean victory, List<CombatRound> rounds, 
                          int finalPlayerEnergy, int finalEnemyEnergy,
                          List<Spirit> finalPlayerSpirits) {
            this.victory = victory;
            this.rounds = rounds;
            this.finalPlayerEnergy = finalPlayerEnergy;
            this.finalEnemyEnergy = finalEnemyEnergy;
            this.finalPlayerSpirits = finalPlayerSpirits;
        }

        // Getters
        public boolean isVictory() { return victory; }
        public List<CombatRound> getRounds() { return rounds; }
        public int getFinalPlayerEnergy() { return finalPlayerEnergy; }
        public int getFinalEnemyEnergy() { return finalEnemyEnergy; }
        public List<Spirit> getFinalPlayerSpirits() { return finalPlayerSpirits; }
    }

    public static class CombatRound {
        private final int roundNumber;
        private final List<CombatAction> actions;

        public CombatRound(int roundNumber) {
            this.roundNumber = roundNumber;
            this.actions = new ArrayList<>();
        }

        public void addAction(CombatAction action) {
            actions.add(action);
        }

        public int getRoundNumber() { return roundNumber; }
        public List<CombatAction> getActions() { return actions; }
    }

    public static class CombatAction {
        private final String attacker;
        private final String defender;
        private final String skill;
        private final int damage;
        private final int remainingEnergy;

        public CombatAction(String attacker, String defender, String skill, 
                          int damage, int remainingEnergy) {
            this.attacker = attacker;
            this.defender = defender;
            this.skill = skill;
            this.damage = damage;
            this.remainingEnergy = remainingEnergy;
        }

        // Getters
        public String getAttacker() { return attacker; }
        public String getDefender() { return defender; }
        public String getSkill() { return skill; }
        public int getDamage() { return damage; }
        public int getRemainingEnergy() { return remainingEnergy; }
    }

    private static class Combatant {
        private final Spirit spirit;
        private final boolean isPlayer;

        public Combatant(Spirit spirit, boolean isPlayer) {
            this.spirit = spirit;
            this.isPlayer = isPlayer;
        }

        public Spirit getSpirit() { return spirit; }
        public boolean isPlayer() { return isPlayer; }
    }
}
```

---

## ë¶€ë¡ E: WebSocket êµ¬í˜„ ìƒì„¸

### E.1 WebSocket ì„¤ì •

ì •ë ¹ ê´‘ì¥ì—ì„œ ì‹¤ì‹œê°„ ì±„íŒ…ì„ ìœ„í•´ WebSocketì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

**WebSocketConfig.java** (ì¶”ì •):

```java
package com.soi.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;
import org.springframework.web.socket.config.annotation.StompEndpointRegistry;
import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;

@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry config) {
        config.enableSimpleBroker("/topic", "/queue");
        config.setApplicationDestinationPrefixes("/app");
    }

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws")
                .setAllowedOriginPatterns("*")
                .withSockJS();
    }
}
```

### E.2 WebSocket ë©”ì‹œì§€ ì²˜ë¦¬

**SpiritSquareController.java** (WebSocket ë¶€ë¶„):

```java
@Controller
public class SpiritSquareController {

    @Autowired
    private SimpMessagingTemplate messagingTemplate;

    @MessageMapping("/chat.send")
    public void sendMessage(@Payload ChatMessage chatMessage) {
        // ë©”ì‹œì§€ ì €ì¥
        chatMessageRepository.save(chatMessage);
        
        // ì±„ë„ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸
        messagingTemplate.convertAndSend(
            "/topic/channel/" + chatMessage.getChannelNumber(), 
            chatMessage
        );
    }

    @MessageMapping("/presence.update")
    public void updatePresence(@Payload SpiritSquarePresence presence) {
        // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        presenceRepository.save(presence);
        
        // ì±„ë„ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸
        messagingTemplate.convertAndSend(
            "/topic/channel/" + presence.getChannelNumber() + "/presence",
            presence
        );
    }
}
```

---

## ì°¸ê³  ë¬¸í—Œ

1. Spring Boot ê³µì‹ ë¬¸ì„œ: https://spring.io/projects/spring-boot
2. Spring Security ê³µì‹ ë¬¸ì„œ: https://spring.io/projects/spring-security
3. Thymeleaf ê³µì‹ ë¬¸ì„œ: https://www.thymeleaf.org/
4. H2 Database ë¬¸ì„œ: https://www.h2database.com/
5. Docker ê³µì‹ ë¬¸ì„œ: https://docs.docker.com/
6. Nginx ê³µì‹ ë¬¸ì„œ: https://nginx.org/en/docs/
7. WebSocket API ë¬¸ì„œ: https://developer.mozilla.org/en-US/docs/Web/API/WebSocket
8. JPA/Hibernate ë¬¸ì„œ: https://hibernate.org/orm/documentation/

---

**ë³´ê³ ì„œ ì‘ì„±ì¼**: 2025ë…„ 11ì›” 30ì¼  
**ì‘ì„±ì**: [ì‘ì„± í•„ìš”]  
**í”„ë¡œì íŠ¸ ë²„ì „**: 1.0.0

---

*ë³¸ ë³´ê³ ì„œëŠ” ì •ë ¹ì˜ ì„¬ (SOI) í”„ë¡œì íŠ¸ì˜ ì „ì²´ ê°œë°œ ê³¼ì •ê³¼ êµ¬í˜„ ë‚´ìš©ì„ ìƒì„¸íˆ ê¸°ë¡í•œ ë¬¸ì„œì…ë‹ˆë‹¤. ì´ 300ì¥ ë¶„ëŸ‰ì˜ ìƒì„¸í•œ ê¸°ìˆ  ë¬¸ì„œë¡œ, ì†ŒìŠ¤ì½”ë“œì™€ í•¨ê»˜ í”„ë¡œì íŠ¸ì˜ ëª¨ë“  ì¸¡ë©´ì„ ë‹¤ë£¨ê³  ìˆìŠµë‹ˆë‹¤.*
